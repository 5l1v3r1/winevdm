file(GLOB SOURCE *.c *.cpp)
add_library(krnl386 SHARED ${SOURCE} krnl386.def krnl386.exe16.obj)
include_directories(../wine)
add_definitions(-DMZ_SUPPORTED -DENABLEREDIRECTSYSTEMDIR -D_X86_ -D__WINESRC__ -D__i386__ -DUSE_COMPILER_EXCEPTIONS -DHAVE_STRNCASECMP -DHAVE__STRNICMP -D_WINTERNL_ -DNtCurrentTeb=NtCurrentTeb__ -Dinline=__inline -DDECLSPEC_HIDDEN=)
add_custom_command(OUTPUT krnl386.exe16.asm
COMMAND convspec ${CMAKE_CURRENT_LIST_DIR}/krnl386.exe16.spec KERNEL > krnl386.exe16.asm && ${ASM_TOOL_DIR}/as --32 -o krnl386.exe16.obj krnl386.exe16.asm)
add_custom_target(generate_asm DEPENDS krnl386.exe16.asm)
add_dependencies(krnl386 generate_asm convspec)
target_link_libraries(krnl386  libwine winecrt0 lz32.lib ntdll.lib ddraw.lib dsound.lib wow32)
set(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} /SAFESEH:NO")
